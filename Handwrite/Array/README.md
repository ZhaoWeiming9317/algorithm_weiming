# 数组方法手写实现

## 实现思路

### map 方法
1. 核心思路：
   - 创建新数组保存映射结果
   - 遍历原数组，对每个元素执行回调
   - 保持数组长度和索引对应关系

2. 常见错误：
   - 没有处理 this 为 null/undefined 的情况
   - 没有处理 callback 不是函数的情况
   - 没有处理稀疏数组（空位）
   - 修改了原数组

3. 进阶实现：
   - 支持 thisArg 参数
   - 处理类数组对象
   - 优化性能（预分配数组长度）

### filter 方法
1. 核心思路：
   - 创建新数组保存结果
   - 遍历原数组，执行回调判断
   - 只保留返回真值的元素

2. 常见错误：
   - 没有进行真值判断
   - 直接修改原数组
   - 没有处理稀疏数组

3. 进阶实现：
   - 支持 thisArg 参数
   - 优化内存使用（预判数组大小）

### reduce 方法
1. 核心思路：
   - 处理初始值和起始索引
   - 累积执行回调函数
   - 处理空数组边界情况

2. 常见错误：
   - 没有处理无初始值时空数组的情况
   - 没有正确处理起始索引
   - 没有处理稀疏数组

3. 进阶实现：
   - 支持 thisArg 参数
   - 优化大数组性能

### flat 方法
1. 核心思路：
   - 递归或迭代处理嵌套数组
   - 控制扁平化深度
   - 处理特殊值（null/undefined）

2. 常见错误：
   - 深度计算错误
   - 没有处理非数组元素
   - 递归实现可能栈溢出

3. 进阶实现：
   - 使用迭代替代递归
   - 支持自定义深度
   - 处理类数组对象

## 性能优化建议

1. 预分配数组大小
2. 减少不必要的函数调用
3. 使用迭代替代递归
4. 优化数组连接操作

## 面试变体

1. 实现 mapAsync：支持异步回调的 map
2. 实现 filterInPlace：原地过滤数组
3. 实现 reduceRight：从右到左归并
4. 实现 flatMap：结合 map 和 flat 的功能

## 测试用例

```javascript
// map 测试
[1, 2, 3].myMap(x => x * 2) // [2, 4, 6]
[1, , 3].myMap(x => x * 2)  // [2, empty, 6]

// filter 测试
[1, 2, 3].myFilter(x => x > 1) // [2, 3]
[1, , 3].myFilter(x => x > 1)  // [3]

// reduce 测试
[1, 2, 3].myReduce((acc, cur) => acc + cur, 0) // 6
[].myReduce((acc, cur) => acc + cur) // TypeError

// flat 测试
[1, [2, [3, 4]]].myFlat()    // [1, 2, [3, 4]]
[1, [2, [3, 4]]].myFlat(2)   // [1, 2, 3, 4]
```
