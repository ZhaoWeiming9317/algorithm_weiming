# æ‹“æ‰‘æ’åº (Topological Sort)

æ‹“æ‰‘æ’åºæ˜¯å¯¹æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰çš„é¡¶ç‚¹è¿›è¡Œçº¿æ€§æ’åºï¼Œä½¿å¾—å¯¹äºä»»ä½•æœ‰å‘è¾¹ (u, v)ï¼Œé¡¶ç‚¹ u åœ¨æ’åºä¸­éƒ½å‡ºç°åœ¨é¡¶ç‚¹ v ä¹‹å‰ã€‚

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æ‹“æ‰‘æ’åºï¼Ÿ
- **å®šä¹‰**ï¼šå¯¹æœ‰å‘æ— ç¯å›¾çš„æ‰€æœ‰é¡¶ç‚¹è¿›è¡Œçº¿æ€§æ’åº
- **å‰ææ¡ä»¶**ï¼šå›¾å¿…é¡»æ˜¯æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰
- **ç»“æœ**ï¼šå¦‚æœå­˜åœ¨è¾¹ u â†’ vï¼Œåˆ™ u åœ¨æ‹“æ‰‘åºåˆ—ä¸­å¿…é¡»å‡ºç°åœ¨ v ä¹‹å‰

### åº”ç”¨åœºæ™¯
1. **ä»»åŠ¡è°ƒåº¦**ï¼šç¡®å®šä»»åŠ¡æ‰§è¡Œé¡ºåºï¼ˆæœ‰ä¾èµ–å…³ç³»çš„ä»»åŠ¡ï¼‰
2. **è¯¾ç¨‹å®‰æ’**ï¼šç¡®å®šè¯¾ç¨‹å­¦ä¹ é¡ºåºï¼ˆå…ˆä¿®è¯¾ç¨‹å…³ç³»ï¼‰
3. **ç¼–è¯‘é¡ºåº**ï¼šç¡®å®šæºæ–‡ä»¶ç¼–è¯‘é¡ºåºï¼ˆä¾èµ–å…³ç³»ï¼‰
4. **é¡¹ç›®ç®¡ç†**ï¼šç¡®å®šé¡¹ç›®ä»»åŠ¡æ‰§è¡Œé¡ºåº
5. **å­—å…¸åºé—®é¢˜**ï¼šæ ¹æ®å­—ç¬¦é—´çš„é¡ºåºå…³ç³»ç¡®å®šå­—æ¯è¡¨é¡ºåº

## ğŸ”§ ç®—æ³•å®ç°

### 1. Kahnç®—æ³•ï¼ˆBFSå®ç°ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šä¸æ–­ç§»é™¤å…¥åº¦ä¸º0çš„é¡¶ç‚¹

```javascript
function topologicalSortBFS(graph, numVertices) {
    // 1. è®¡ç®—æ‰€æœ‰é¡¶ç‚¹çš„å…¥åº¦
    const inDegree = new Array(numVertices).fill(0);
    for (let u = 0; u < numVertices; u++) {
        for (const v of graph[u]) {
            inDegree[v]++;
        }
    }
    
    // 2. å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—
    const queue = [];
    for (let i = 0; i < numVertices; i++) {
        if (inDegree[i] === 0) {
            queue.push(i);
        }
    }
    
    // 3. BFSå¤„ç†
    const result = [];
    while (queue.length > 0) {
        const current = queue.shift();
        result.push(current);
        
        // ç§»é™¤å½“å‰é¡¶ç‚¹ï¼Œæ›´æ–°é‚»æ¥é¡¶ç‚¹çš„å…¥åº¦
        for (const neighbor of graph[current]) {
            inDegree[neighbor]--;
            if (inDegree[neighbor] === 0) {
                queue.push(neighbor);
            }
        }
    }
    
    // 4. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¯
    return result.length === numVertices ? result : [];
}
```

**æ—¶é—´å¤æ‚åº¦**ï¼šO(V + E)  
**ç©ºé—´å¤æ‚åº¦**ï¼šO(V)

### 2. DFSå®ç°ï¼ˆååºéå†ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šä½¿ç”¨DFSçš„ååºéå†ï¼Œå®Œæˆè®¿é—®çš„é¡¶ç‚¹æŒ‰é€†åºæ’åˆ—

```javascript
function topologicalSortDFS(graph, numVertices) {
    const colors = new Array(numVertices).fill(0); // 0:æœªè®¿é—® 1:è®¿é—®ä¸­ 2:å·²å®Œæˆ
    const result = [];
    let hasCycle = false;
    
    function dfs(node) {
        if (colors[node] === 1) {
            hasCycle = true; // å‘ç°ç¯
            return;
        }
        if (colors[node] === 2) {
            return; // å·²è®¿é—®è¿‡
        }
        
        colors[node] = 1; // æ ‡è®°ä¸ºè®¿é—®ä¸­
        
        for (const neighbor of graph[node]) {
            if (hasCycle) return;
            dfs(neighbor);
        }
        
        colors[node] = 2; // æ ‡è®°ä¸ºå·²å®Œæˆ
        result.push(node); // ååºéå†
    }
    
    for (let i = 0; i < numVertices; i++) {
        if (colors[i] === 0) {
            dfs(i);
            if (hasCycle) return [];
        }
    }
    
    return result.reverse(); // é€†åºå¾—åˆ°æ‹“æ‰‘åºåˆ—
}
```

**æ—¶é—´å¤æ‚åº¦**ï¼šO(V + E)  
**ç©ºé—´å¤æ‚åº¦**ï¼šO(V)

## ğŸ¯ ç»å…¸é¢˜ç›®

### 1. è¯¾ç¨‹è¡¨ (Course Schedule)
- **LeetCode 207**
- **é—®é¢˜**ï¼šåˆ¤æ–­æ˜¯å¦èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼ˆæ£€æµ‹æœ‰å‘å›¾ä¸­æ˜¯å¦æœ‰ç¯ï¼‰
- **è§£æ³•**ï¼šä½¿ç”¨æ‹“æ‰‘æ’åºï¼Œå¦‚æœèƒ½å¤„ç†æ‰€æœ‰é¡¶ç‚¹åˆ™æ— ç¯

### 2. è¯¾ç¨‹è¡¨ II (Course Schedule II)
- **LeetCode 210**
- **é—®é¢˜**ï¼šè¿”å›å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„é¡ºåº
- **è§£æ³•**ï¼šæ‹“æ‰‘æ’åºï¼Œè¿”å›æ’åºç»“æœ

### 3. å¤–æ˜Ÿäººå­—å…¸ (Alien Dictionary)
- **LeetCode 269**
- **é—®é¢˜**ï¼šæ ¹æ®å¤–æ˜Ÿè¯­è¨€çš„è¯å…¸é¡ºåºæ¨å¯¼å­—æ¯é¡ºåº
- **è§£æ³•**ï¼šæ„å»ºå­—ç¬¦é—´çš„æœ‰å‘å›¾ï¼Œè¿›è¡Œæ‹“æ‰‘æ’åº

## ğŸ” ç®—æ³•å¯¹æ¯”

| ç®—æ³• | å®ç°æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| Kahnç®—æ³• | BFS + å…¥åº¦è¡¨ | ç›´è§‚æ˜“æ‡‚ï¼Œä¾¿äºç†è§£ | éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨å…¥åº¦ | åœ¨çº¿ç®—æ³•ï¼Œé€‚åˆåŠ¨æ€æ·»åŠ è¾¹ |
| DFSç®—æ³• | DFS + ååºéå† | ç©ºé—´æ•ˆç‡é«˜ | éœ€è¦å¤„ç†é€’å½’æ ˆ | ç¦»çº¿ç®—æ³•ï¼Œé€‚åˆé™æ€å›¾ |

## ğŸ’¡ è§£é¢˜æŠ€å·§

### 1. è¯†åˆ«æ‹“æ‰‘æ’åºé—®é¢˜
- å…³é”®è¯ï¼š**ä¾èµ–å…³ç³»**ã€**å…ˆåé¡ºåº**ã€**å‰ç½®æ¡ä»¶**
- å›¾ç‰¹å¾ï¼š**æœ‰å‘å›¾**ã€**éœ€è¦æ£€æµ‹ç¯**

### 2. æ„å»ºå›¾çš„æŠ€å·§
```javascript
// æ–¹æ³•1ï¼šé‚»æ¥è¡¨
const graph = Array.from({ length: n }, () => []);
for (const [from, to] of edges) {
    graph[from].push(to);
}

// æ–¹æ³•2ï¼šé‚»æ¥çŸ©é˜µï¼ˆé€‚åˆç¨ å¯†å›¾ï¼‰
const graph = Array.from({ length: n }, () => new Array(n).fill(false));
for (const [from, to] of edges) {
    graph[from][to] = true;
}
```

### 3. ç¯æ£€æµ‹
- **Kahnç®—æ³•**ï¼šæœ€ç»ˆå¤„ç†çš„é¡¶ç‚¹æ•° < æ€»é¡¶ç‚¹æ•°
- **DFSç®—æ³•**ï¼šè®¿é—®è¿‡ç¨‹ä¸­é‡åˆ°æ­£åœ¨è®¿é—®çš„é¡¶ç‚¹

### 4. è¾¹ç•Œæƒ…å†µå¤„ç†
- ç©ºå›¾ï¼šè¿”å›æ‰€æœ‰é¡¶ç‚¹çš„ä»»æ„æ’åˆ—
- å•ä¸ªé¡¶ç‚¹ï¼šç›´æ¥è¿”å›è¯¥é¡¶ç‚¹
- å­˜åœ¨ç¯ï¼šè¿”å›ç©ºæ•°ç»„æˆ–æŠ¥é”™

## ğŸš€ ä¼˜åŒ–æŠ€å·§

### 1. ç©ºé—´ä¼˜åŒ–
```javascript
// ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–é¢œè‰²æ ‡è®°
const WHITE = 0, GRAY = 1, BLACK = 2;
const colors = new Array(n).fill(WHITE);
```

### 2. æ—©æœŸç»ˆæ­¢
```javascript
// åœ¨DFSä¸­ä¸€æ—¦å‘ç°ç¯å°±ç«‹å³è¿”å›
if (hasCycle) return [];
```

### 3. æ‰¹é‡å¤„ç†
```javascript
// ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰å…¥åº¦ä¸º0çš„é¡¶ç‚¹
while (queue.length > 0) {
    const size = queue.length;
    for (let i = 0; i < size; i++) {
        // å¤„ç†å½“å‰å±‚çš„æ‰€æœ‰é¡¶ç‚¹
    }
}
```

## ğŸ“ å¸¸è§é”™è¯¯

1. **å¿˜è®°æ£€æµ‹ç¯**ï¼šæ‹“æ‰‘æ’åºçš„å‰ææ˜¯æ— ç¯å›¾
2. **è¾¹çš„æ–¹å‘é”™è¯¯**ï¼šæ³¨æ„ä¾èµ–å…³ç³»çš„æ–¹å‘
3. **é‡å¤è¾¹å¤„ç†**ï¼šé¿å…åœ¨å›¾ä¸­æ·»åŠ é‡å¤çš„è¾¹
4. **è¾¹ç•Œæƒ…å†µé—æ¼**ï¼šç©ºå›¾ã€å•é¡¶ç‚¹å›¾ç­‰ç‰¹æ®Šæƒ…å†µ

## ğŸ”— ç›¸å…³ç®—æ³•

- **å¼ºè¿é€šåˆ†é‡**ï¼šTarjanç®—æ³•ã€Kosarajuç®—æ³•
- **æœ€çŸ­è·¯å¾„**ï¼šåœ¨DAGä¸Šçš„æœ€çŸ­è·¯å¾„å¯ä»¥ç”¨æ‹“æ‰‘æ’åºä¼˜åŒ–
- **å…³é”®è·¯å¾„**ï¼šé¡¹ç›®ç®¡ç†ä¸­çš„å…³é”®è·¯å¾„é—®é¢˜

## ğŸ“š æ‰©å±•é˜…è¯»

- å›¾è®ºåŸºç¡€
- æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰çš„æ€§è´¨
- å›¾çš„éå†ç®—æ³•ï¼ˆBFSã€DFSï¼‰
- å¼ºè¿é€šåˆ†é‡ç®—æ³•
